---
title: "Final Project"
author: "Liam Whitenack"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
# Set knitr options
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(broom))
# Load dataset
college <- read_rds("college.rds") %>%
  type_convert(
    na=combine("", "NA", "PrivacySuppressed")
  )
# Set seed
set.seed(98261936)
```

## Question of Interest
* **Is there a relationship between a college's SAT score average among students and the earnings of it's students six years after enrollment (excluding currently enrolled students)?**  
* Some of the columns of the dataset that I plan on using are "SAT_AVG", "INSTNM", "PREDDEG" and "MN_EARN_WNE_P6"  
* When searching for colleges, a big question of whether a college is worthwhile is examining whether the college will lead to a competetive salary after graduation. This study will help determine whether or not the average SAT score of the college is a factor that should go into account when searching for colleges.



## Preprocessing
```{r}
college_reduced <- college %>%
    select(SAT_AVG, MN_EARN_WNE_P6, PREDDEG, INSTNM)
```
This code block pulls the variables from the dataset that I would like to use for this project.   
i. SAT_AVG is the average SAT score of the students at a particular college.  
ii. MN_EARN_WNE_P6 is the average earnings of an individual 6 years after they enroll at the school (excluding the ones still in school).  
iii. PREDDEG is the type of degree the college predominantly awards to its students.  
iv. INSTNM is the name of the college, which can be used to examine individual data points.  

```{r}
college_reduced <- college_reduced %>%
  mutate(
    average_SAT_score = SAT_AVG,
    mean_earnings = MN_EARN_WNE_P6,
  )
```
This code block renames the variables I want to use.  

```{r}
college_reduced <- college_reduced %>%
  mutate(
    Degree_Type = recode(
        PREDDEG,
        `0` = "Not Classified",
        `1` = "Predominantly certificate-degree granting",
        `2` = "Predominantly associate's-degree granting",
        `3` = "Predominantly bachelor's-degree granting",
        `4` = "Predominantly graduate-degree granting"
    )
  )
```
This code block edits the values of the categorical variables to make the number values represent their meanings, in this case for the variable "PREDDEG".

## Visualization
1. What type of variation occurs within my variables?  

This graph will be used to see how the range of SAT scores are distributed among colleges, distinguishing between the different types of colleges.
```{r, fig.width = 8}
college_reduced %>%
  ggplot() + 
  geom_histogram(mapping = aes(x = average_SAT_score, fill = Degree_Type),
                 alpha = 0.5, position = "identity", bins = 20, 
                 na.rm = TRUE) +
  facet_wrap( ~ Degree_Type) +
  labs(title = "Average SAT Score of Colleges Histogram") +
  xlab("SAT Score")
```
This graph shows the distibution of mean SAT scores between colleges and shows that the most common average SAT scores of colleges fall between 1000 and 1125  
  

This graph will be used to see how the range of salaries after graduation are distributed, distinguishing between the different types of colleges.
```{r, fig.width = 8}
college_reduced %>%
  ggplot() + 
  geom_histogram(mapping = aes(x = mean_earnings, fill = Degree_Type), 
                 alpha = 0.5, position = "identity", 
                 bins = 20, na.rm = TRUE) +
  facet_wrap( ~ Degree_Type) +
  labs(title = "Mean Salaries of College Students Histogram") +
  xlab("Mean Earnings")
```
This graph shows the distibution of mean salaries of students 6 years after enrollment between colleges and shows that the most common average salaries fall between 20000 and 30000. This graph is left-skewed.  

2. What type of covariation occurs between my variables?  

This scatterplot should show what values are most common and colors them by their different types. This will accurately report every point on the graph, showing what each college achieves
```{r, fig.width = 8}
college_reduced %>%
  ggplot() + 
  geom_point(mapping = aes(x = average_SAT_score, y = mean_earnings, 
                           color = Degree_Type), alpha = 0.5, 
             na.rm = TRUE) + 
  labs(title = "Covariation Scatterplot") +
  xlab("SAT Score") +
  ylab("Earnings")
```
This scatterplot shows that the most common outputs agree with what I learned from the histograms and seems to imply that the most common SAT scores correlate with the most common Earnings after graduation. This graph shows that there is a loose correlation of SAT scores and mean_earnings, pointing to a relationship but leaves lots of outliers.   
  

This graph will show the median, interquartile ranges, and outliers of each SAT score distribution of 200 points. 
```{r, fig.width = 8}
college_reduced %>%
  ggplot(mapping = aes(x = average_SAT_score, y = mean_earnings)) + 
  geom_boxplot(mapping = aes(group = cut_width(average_SAT_score, 200)), 
               na.rm = TRUE) + 
  labs(title = "Covariation Boxplot") +
  xlab("SAT Score") +
  ylab("Earnings")
```
This graph gives an in-depth analysis of the correlation between Earnings and SAT scores. The graph shows that aside from outliers, there is a strong correlation. There aren't a surprising amount of outliers, but there is a very appealing college with a mean salary that exceeds every other value without a high SAT score. The amount of outliers in the middle points to the fact that the middle of the graph has the most values.   
  
This graph will simplify the process of estimating the correlation between SAT scores and post-enrollment earnings, creating a linear model that estimates with a straight line and another model that estimates on a more specific scale.
```{r, fig.width = 8}
college_reduced %>%
  ggplot(mapping = aes(x = average_SAT_score, y = mean_earnings), 
         na.rm = TRUE) + 
  geom_smooth(na.rm = TRUE) + 
  geom_smooth(method = "lm", color = "red", na.rm = TRUE) +
  labs(title = "Covariation Trend Line") +
  xlab("SAT Score") +
  ylab("Earnings")
```
This graph shows how Earnings are affected as SAT scores are increased. Even though it is tempting to state that there is a clear causation here, it is important to remember that correlation does not imply causation.  
  
These graphs show that while SAT scores increase, earnings also apppear to increase. This is not proved from our models, but the linear estimation does prove that the estimated linear model is an upward slope. We do not know that this is a causation, but the data does imply that if one chooses a college with a high SAT score average, they have a better chance of a high salary.  


## Summary Statistics
```{r}
college_reduced %>%
  group_by(Degree_Type) %>%
  summarise( 
    Count = n(),
  )
```
This chart of summary statistics states how many observations of each college there are. There are a lot of colleges that grant certificates, more than colleges that grant bachelor's degrees. However, they don't report SAT scores. Neither do many of the associate's or graduate's degree granting schools. As a result, we are primarily looking at the schools that predominantly grant bachelor's degrees.
```{r}
college_reduced %>%
  group_by(Degree_Type) %>%
  summarise( 
    Mean = mean(average_SAT_score, na.rm = TRUE),
    Median = median(average_SAT_score, na.rm = TRUE),
    StdDev = sd(average_SAT_score, na.rm = TRUE),
    Max = max(average_SAT_score, na.rm = TRUE),
    Min = min(average_SAT_score, na.rm = TRUE),
    IQR = IQR(average_SAT_score, na.rm = TRUE)
  )
```
As we can see in this chunk, the not classified and graduate's-degree columns are worth ignoring, because their SAT scores are not recorded. I will primarily focus on the Bachelor's-degree granting schools. The mean is slightly larger than the median, which means that the histogram of this data would be slightly right-skewed. It looks like almost all of the data falls close to 1125 SAT points. The IQR is 153, which means that most of the data on the graph would fall between 1000 and 1300. This is a sign that most colleges have an SAT score in that range, which implies that not many colleges have average SAT scores above or below that range. This does not necessarily mean, however, that most students achieve scores in that range.
```{r}
college_reduced %>%
  group_by(Degree_Type) %>%
  summarise( 
    Mean = mean(mean_earnings, na.rm = TRUE),
    Median = median(mean_earnings, na.rm = TRUE),
    StdDev = sd(mean_earnings, na.rm = TRUE),
    Max = max(mean_earnings, na.rm = TRUE),
    Min = min(mean_earnings, na.rm = TRUE),
    IQR = IQR(mean_earnings, na.rm = TRUE)
  )
```
Once again, I will be primarily looking at the third row of this dataset. It is worth pointing out that the incomes after graduating are significantly different, with graduate's-degree earning colleges scoring the best here (who would have guessed?). The histogram of this dataset would also be slightly right-skewed. We can see here that the colleges generally score in between $30,000 and $40,000. Many of the factors of having such a high maximum and minimum could be a result of having colleges that specialize in certain fields. If a school focuses on Psycology, it will most likely result in low incomes, regardless of SAT scores. On the other hand, a law school does just the opposite. 

These three sections display useful information when examining the graph, showing us the data on an individual scale, examinign its mean, median, standard deviation, maximum, minimum, and interquartile range. it also show the total number of variables in the first code block.   


## Data Analysis

```{r}
college_model_lm <- lm(mean_earnings ~ average_SAT_score, data = college_reduced)
```
```{r}
college_model_lm %>%
  tidy()
```
```{r}
college_model_lm %>%
  glance() %>%
  select(r.squared:logLik)
```
In these datasets, I am mostly only concerned with three of these columns, "estimate", which tells us the Intercept and Slope of the linear model, and "r.squared", which calculates how far away the point is from the line, sqared. This can be loosely thought of as the fraction of variation in y that is explained by your model. These values are both significatnly low, but are good enough, given that we are working with a social science dataset, our r.squared is acceptable. Our slope is 49, which means that, on average, for every point higher the college's SAT score is, the people that enroll make roughly an extra $50 a year.  

```{r}
college_model <- college_reduced %>%
  add_predictions(college_model_lm) %>%
  add_residuals(college_model_lm)
```
```{r}
college_model %>%
  ggplot() +
  geom_point(mapping = aes(x = average_SAT_score, y = mean_earnings), 
             na.rm = TRUE, alpha = 0.1) +
  geom_abline(slope = college_model_lm$coefficients[2],   
              intercept = college_model_lm$coefficients[1]) +
  labs(title = "Residual Examination Plot") +
  xlab("Average SAT") +
  ylab("Salary")
```
```{r}
college_model %>%
  ggplot() +
  geom_point(mapping = aes(x = mean_earnings, y = pred),   
  na.rm = TRUE, alpha = 0.1) +
  geom_smooth(mapping = aes(x = mean_earnings, y = pred), 
              method = "lm", color = "red", 
              na.rm = TRUE) +
  geom_smooth(mapping = aes(x = mean_earnings, y = pred), 
              color = "green", 
              na.rm = TRUE) +
  geom_abline(slope = 1, intercept = 0, color = "blue") +
  labs(title = "Observed vs. Predicted Plot") +
  xlab("Observed") +
  ylab("Predicted")
```
This graph displays the slope we are looking for (blue), the overall slope of the scatterplot (red), and the scatterplot's slope at each point (green).
```{r}
college_model %>%
  ggplot() +
  geom_point(mapping = aes(y = resid, x = pred), na.rm = TRUE, 
             alpha = 0.1) +
  geom_smooth(mapping = aes(y = resid, x = pred), 
              method = "lm", color = "blue", 
              na.rm = TRUE) +
  geom_smooth(mapping = aes(y = resid, x = pred), 
              color = "green", 
              na.rm = TRUE) +
  geom_hline(yintercept = 0, color = "red") +
  labs(title = "Residual vs. Predicted Plot") +
  xlab("Predictions") +
  ylab("Residuals")
```
This graph displays the slope we are looking for (blue), the overall slope of the scatterplot (red), and the scatterplot's slope at each point (green).
```{r}
college_model %>%
  ggplot() +
  geom_qq(aes(sample = resid), na.rm = TRUE) +
  geom_qq_line(aes(sample = resid, color = "red"), na.rm = TRUE)+
  labs(title = "Q-Q Plot") +
  xlab("Theoretical") +
  ylab("Sample")
```
All three of these graphs have to be met with perspective. For lab sciences such as chemistry or physics, the points on the above graphs are very far off from what would be expected. However, since our data is working with a social science, the above data points to a decent correlation that is suitable for the purposes of this study.  

1. The first assumption we have to make for this graph is that it is linearity. Using the Observed vs. Predicted graph, we can see that there are many points that do not fall on the slope that was predicted for the graph. However, a large portion of points fall very close to the slope we are looking for. Because there are so many factors that could be involved in a social science dataset like this, it is harder to reject this assumption. Still, the model is not close enough to assume linearity, and the model is rejected.  
2. Nearly normal residuals: Using our Q-Q plot, we can see that on the right side, a high number of points fall off of the linear slope. However, because of the variation in the dataset, the second assumption is just slightly violated.  
3. Constant Variability: Even though, just like before, there are plenty of outliers, there is a correlation between the residuals and the predictions, and the variability of the model is roughly constant. The value of the residuals above and below the prediction is enough to discredit the third point, and the third assumption is slightly violated. Once again, the model is not perfect, but it can still teach us something.  



## Conclusion
Is there a relationship between a college's SAT score average among students and the earnings of it's students six years after enrollment (excluding currently enrolled students)?  

This question was of interest to me because I was interested in knowing if the 'prestige' of a college is reason enough to enroll in a much more expensive school. This research project alone is not enough on it's own to research a question like this, but it does offer some useful information towards the subject. There are many questions that are raised after asking a question like this, such as, "Does having a higher SAT score affect your earnings six years after graduating?" and "Do higher college SAT scores result in a more expensive school?" Both of these questions would be beneficial to know the answer to when applying for colleges. However, the question at hand can only answer if the SAT scores of colleges affect earnings 6 years after enrollment.     
This analysis seems, at first, to point to the fact that, on average, as the average SAT score of a college increases, so does the earnings of the students. Bachelor's students make up the majority of the complete information, so my study mainly focuses on the data there. Although the points are scattered and seem to be completely spread out, there is a visible upwards trend, which is especially apparent in the smooth line graph. The next step, then, is to determine whether or not our linear model is worth trusting. When we test the model against the three assumptions required, it does not hold up. Although it comes close, we see that the data does not fall nicely into the requirements to be a trusted model. This points to the fact that on an, on an individual scale, it is hard to trust the model being presented as a reliable source to make decisions based off of. However, there is strong evidence towards the fact that when the college SAT scores are higher, the salaries after graduation increase. There are, of course, many exceptions. Law schools and Medical schools are going to have a much higher salary than their competetors. However, this project provides information to think on and process regarding the significance of a college's average SAT score after graduation.




